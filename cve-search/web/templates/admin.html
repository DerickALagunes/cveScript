{% extends 'layouts/master-page' %}
{% block title %}Admin page{% endblock %}
{% block head %}
  <!-- css -->
  <link href="/static/css/custom/admin.css" rel="stylesheet" />

  <!-- javascript -->
  <script type="text/javascript" src="/static/js/custom/admin.js"></script>
  <script>
    {% if status %}
      data = {status: "{{status}}"}
      parseStatus(data);
    {% endif %}
  </script>
{% endblock %}
{% block content %}
  <div id='stats' class="well well-small">
    <div>
      <span>Database info for database <b>{{stats['dbName']}}</b></span>
      <table class="table table-hover table-striped table-nonfluid table-condensed">
        <thead>
          <tr class="warning"><td>Collection</td><td>#records</td><td>Last update</td></tr>
        </thead>
        <tr><td>CVES</td>             <td>{{stats['cveA']}}</td>
            <td>{% if stats['cveU'] is not none %}{{stats['cveU']|currentTime}} {% else %}Not updated{% endif %}</td><tr>
        <tr><td>CPE</td>              <td>{{stats['cpeA']}}</td>
            <td>{% if stats['cpeU'] is not none %}{{stats['cpeU']|currentTime}} {% else %}Not updated{% endif %}</td><tr>
        <tr><td>CPE-other</td>        <td>{{stats['cpeOtherA']}}</td>
            <td>{% if stats['cpeOtherU'] is not none %}{{stats['cpeOtherU']|currentTime}} {% else %}Not updated{% endif %}</td><tr>
        <tr><td>Capec</td>            <td>{{stats['capecA']}}</td>
            <td>{% if stats['capecU'] is not none %}{{stats['capecU']|currentTime}} {% else %}Not updated{% endif %}</td><tr>
        <tr><td>d2sec</td>            <td>{{stats['d2secA']}}</td>
            <td>{% if stats['d2secU'] is not none %}{{stats['d2secU']|currentTime}} {% else %}Not updated{% endif %}</td><tr>
        <tr><td>Vendor statements</td><td>{{stats['vendorA']}}</td>
            <td>{% if stats['vendorU'] is not none %}{{stats['vendorU']|currentTime}} {% else %}Not updated{% endif %}</td><tr>
        <tr><td>vFeed info</td>       <td>{{stats['vfeedA']}}</td>
            <td>{% if stats['vfeedU'] is not none %}{{stats['vfeedU']|currentTime}} {% else %}Not updated{% endif %}</td><tr>
      </table>
      <span id="wl_rules">Whitelist: {{stats['wlA']}} rules</span><br />
      <span id="bl_rules">Blacklist: {{stats['blA']}} rules</span><br /><br />
      <span>Database size: {{'%0.2f' % (stats['dbSize']/1024**2)}}MB ({{'%0.2f' % (stats['dbSize']/1024**3)}}GB)</span><br />
      <span>Database size on disk: {{'%0.2f' % (stats['dbOnDisk']/1024**2)}}MB ({{'%0.2f' % (stats['dbOnDisk']/1024**3)}}GB)</span>
    </div>
  </div>
  <!-- Database update -->
  <div class="well well-small tab">
    <strong>Update the database</strong> <br />
    <button onclick="updateDB()">Update</button>
  </div>
  <!-- Whitelist import -->
  <div class="well well-small tab">
    <strong>Manage whitelist</strong> <br />
    <input id="wl_Import" type='file' name='file' /> <br />
    <input type="checkbox" id="wl_ForceImport">Force<br />
    <button onclick="whitelistImport()">Import</button>
    <button onclick="whitelistExport()">Export</button>
    <button onclick="dropWhitelist()">Drop list</button>
    <button onclick="location.href='/admin/whitelist'">View</button>
  </div>
  <!-- Blacklist import -->
  <div class="well well-small tab">
    <strong>Manage blacklist</strong> <br />
    <input id="bl_Import" type='file' name='file' /> <br />
    <input type="checkbox" id="bl_ForceImport">Force<br />
    <button onclick="blacklistImport()">Import</button>
    <button onclick="blacklistExport()">Export</button>
    <button onclick="dropBlacklist()">Drop list</button>
    <button onclick="location.href='/admin/blacklist'">View</button>
  </div>
  <a href="#" class="back-to-top">Back to Top</a>
{% endblock %}
